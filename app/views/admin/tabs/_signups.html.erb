<!-- Sign-ups Analytics Tab -->
<div class="space-y-8">
  <!-- Sign-up Metrics Cards -->
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
    <% signup_metrics = metrics.signup_metrics_with_trends %>
    
    <%= render Admin::TrendCardComponent.new(
      title: "New Sign-ups",
      value: signup_metrics[:total_signups],
      icon: "fas fa-user-plus"
    ) %>
    
    <%= render Admin::TrendCardComponent.new(
      title: "Onboarding Rate",
      value: "#{signup_metrics[:onboarding_completion_rate]}%",
      icon: "fas fa-check-circle"
    ) %>
    
    <%= render Admin::TrendCardComponent.new(
      title: "Conversion Rate",
      value: "#{signup_metrics[:conversion_rate]}%",
      icon: "fas fa-chart-line"
    ) %>
    
    <%= render Admin::TrendCardComponent.new(
      title: "Trial Users",
      value: signup_metrics[:trial_users],
      icon: "fas fa-star"
    ) %>
  </div>

  <!-- Recently Signed Up Users Table -->
  <div>
    <%= render Admin::PaginatedTableComponent.new(
      title: "Recently Signed Up Users",
      users: metrics.recently_signed_up_users,
      columns: [
        { header: "User", type: :user_info },
        { header: "Signed Up", type: :date, field: :created_at },
        { header: "Onboarding Status", type: :onboarding_badge },
        { header: "Plan", type: :plan_badge },
        { header: "Emails Disposed", type: :custom, render: ->(user) { user.metrics&.disposed_count || 0 } }
      ],
      pagination_params: { date_range: params[:date_range], tab: "signups" }
    ) %>
  </div>

  <!-- Sign-up Analytics Insights -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
    <div class="bg-white rounded-lg shadow p-6 border border-gray-200">
      <h3 class="text-lg font-semibold text-gray-900 mb-4">Onboarding Funnel</h3>
      <div class="space-y-4">
        <div class="flex justify-between items-center">
          <span class="text-sm text-gray-600">Total Sign-ups</span>
          <span class="text-sm font-medium text-gray-900"><%= signup_metrics[:total_signups] %></span>
        </div>
        <div class="flex justify-between items-center">
          <span class="text-sm text-gray-600">Completed Onboarding</span>
          <span class="text-sm font-medium text-gray-900">
            <%= (signup_metrics[:total_signups] * signup_metrics[:onboarding_completion_rate] / 100).round %>
          </span>
        </div>
        <div class="flex justify-between items-center">
          <span class="text-sm text-gray-600">Converted to Pro</span>
          <span class="text-sm font-medium text-gray-900">
            <%= (signup_metrics[:total_signups] * signup_metrics[:conversion_rate] / 100).round %>
          </span>
        </div>
        
        <!-- Funnel Visualization -->
        <div class="mt-6 space-y-2">
          <div class="w-full bg-gray-200 rounded-full h-3">
            <div class="bg-blue-600 h-3 rounded-full" style="width: 100%"></div>
          </div>
          <div class="w-full bg-gray-200 rounded-full h-3">
            <div class="bg-green-600 h-3 rounded-full" style="width: <%= signup_metrics[:onboarding_completion_rate] %>%"></div>
          </div>
          <div class="w-full bg-gray-200 rounded-full h-3">
            <div class="bg-purple-600 h-3 rounded-full" style="width: <%= signup_metrics[:conversion_rate] %>%"></div>
          </div>
        </div>
        
        <div class="flex justify-between text-xs text-gray-500 mt-2">
          <span>Sign-ups</span>
          <span>Onboarded</span>
          <span>Converted</span>
        </div>
      </div>
    </div>

    <div class="bg-white rounded-lg shadow p-6 border border-gray-200">
      <h3 class="text-lg font-semibold text-gray-900 mb-4">Sign-up Trends</h3>
      <div class="space-y-3">
        <div class="flex justify-between">
          <span class="text-sm text-gray-600">Sign-ups per Day (Avg)</span>
          <span class="text-sm font-medium text-gray-900">
            <% days_in_period = (metrics.end_date - metrics.start_date).to_i %>
            <%= days_in_period > 0 ? (signup_metrics[:total_signups].to_f / days_in_period).round(1) : 0 %>
          </span>
        </div>
        <div class="flex justify-between">
          <span class="text-sm text-gray-600">Onboarding Drop-off</span>
          <span class="text-sm font-medium text-gray-900">
            <%= (100 - signup_metrics[:onboarding_completion_rate]).round(1) %>%
          </span>
        </div>
        <div class="flex justify-between">
          <span class="text-sm text-gray-600">Conversion Drop-off</span>
          <span class="text-sm font-medium text-gray-900">
            <%= (100 - signup_metrics[:conversion_rate]).round(1) %>%
          </span>
        </div>
        <div class="flex justify-between">
          <span class="text-sm text-gray-600">Trial to Pro Rate</span>
          <span class="text-sm font-medium text-gray-900">
            <% trial_users = signup_metrics[:trial_users] %>
            <% converted = (signup_metrics[:total_signups] * signup_metrics[:conversion_rate] / 100).round %>
            <%= trial_users > 0 ? (converted.to_f / trial_users * 100).round(1) : 0 %>%
          </span>
        </div>
      </div>
    </div>
  </div>
</div>
